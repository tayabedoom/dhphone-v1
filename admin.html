<!DOCTYPE html>
<html lang="en" dir="ltr" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Content Admin | DH Phone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="config.js"></script>
    <script>
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(window.config.firebase);
        }
        window.db = firebase.firestore();
        window.db.settings({
            cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED
        });
        window.db.enablePersistence()
            .catch((err) => {
                if (err.code == 'failed-precondition') {
                    console.warn('Persistence failed - multiple tabs open');
                } else if (err.code == 'unimplemented') {
                    console.warn('Persistence not available');
                }
            });
    </script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .loading-spinner {
            @apply inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600;
        }
        .modal {
            @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50;
        }
        .modal-content {
            @apply bg-white dark:bg-slate-800 rounded-lg p-6 max-w-md w-full mx-4;
        }
        /* Dashboard specific styles */
        .sidebar-link {
            @apply flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors duration-200;
        }
        .sidebar-link.active {
            @apply bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400;
        }
        .sidebar-link:not(.active) {
            @apply text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-slate-800;
        }
        .dashboard-card {
            @apply bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-gray-200 dark:border-slate-700 p-6;
        }
        .stat-card {
            @apply bg-gradient-to-br from-white to-gray-50 dark:from-slate-800 dark:to-slate-700 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-slate-700;
        }
    </style>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-P2PWNTT3');</script>
    <!-- End Google Tag Manager -->
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-slate-900 dark:text-gray-200 transition-colors duration-300 font-sans">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P2PWNTT3"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <!-- Username/Password Modal -->
    <div id="auth-modal" style="position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;">
        <div style="background:white;padding:2rem 2.5rem;border-radius:1rem;box-shadow:0 4px 32px #0002;min-width:320px;max-width:90vw;">
            <h2 style="font-size:1.5rem;font-weight:bold;margin-bottom:1rem;text-align:center;">Admin Login</h2>
            <div style="margin-bottom:1rem;">
                <input id="username-input" type="text" placeholder="Username" style="width:100%;padding:0.5rem 1rem;margin-bottom:0.5rem;border:1px solid #ccc;border-radius:0.5rem;" autofocus>
                <input id="password-input" type="password" placeholder="Password" style="width:100%;padding:0.5rem 1rem;border:1px solid #ccc;border-radius:0.5rem;">
            </div>
            <div id="login-error" style="color:#e53e3e;font-size:0.95rem;margin-bottom:0.5rem;display:none;text-align:center;"></div>
            <button id="login-btn" style="width:100%;padding:0.5rem 0;background:#6366f1;color:white;font-weight:bold;border:none;border-radius:0.5rem;cursor:pointer;">Login</button>
        </div>
    </div>
    <!-- Firebase Configuration -->
    <script src="config.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, doc, getDoc, setDoc, serverTimestamp, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = window.config.firebase;

        // Initialize Firebase
        let app, db, auth, provider;
        
        try {
            console.log('Initializing Firebase with config:', firebaseConfig);
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            provider = new GoogleAuthProvider();
            
            console.log('Firebase services initialized:', { app, db, auth });
            
            // Make Firebase services available globally
            window.db = db;
            window.auth = auth;
            window.collection = collection;
            window.doc = doc;
            window.getDoc = getDoc;
            window.setDoc = setDoc;
            window.serverTimestamp = serverTimestamp;
            window.getDocs = getDocs;
            window.deleteDoc = deleteDoc;
            window.signInWithPopup = signInWithPopup;
            window.GoogleAuthProvider = GoogleAuthProvider;
            window.signOut = signOut;
            window.onAuthStateChanged = onAuthStateChanged;
            window.provider = provider;
            
            console.log('Firebase initialized successfully');
            
            // Set up authentication state listener
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    console.log('User is signed in:', user.uid);
                    updateAuthStatus('Authenticated as ' + (user.displayName || user.email), 'success');
                    document.getElementById('sign-in-btn').style.display = 'none';
                    document.getElementById('sign-out-btn').classList.remove('hidden');
                } else {
                    console.log('User is signed out');
                    updateAuthStatus('Not authenticated', 'warning');
                    document.getElementById('sign-in-btn').style.display = 'block';
                    document.getElementById('sign-out-btn').classList.add('hidden');
                }
            });
            
        } catch (error) {
            console.error('Error initializing Firebase:', error);
            console.error('Firebase config used:', firebaseConfig);
            alert('Error initializing Firebase: ' + error.message + '\n\nPlease check your configuration and internet connection.');
        }
    </script>

    <div class="min-h-screen flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-white dark:bg-slate-800 border-r border-gray-200 dark:border-slate-700 hidden lg:block">
            <div class="h-20 flex items-center px-6 border-b border-gray-200 dark:border-slate-700">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-primary-100 dark:bg-primary-900/30 rounded-lg flex items-center justify-center">
                        <i class="fas fa-cogs text-primary-600 dark:text-primary-400 text-xl"></i>
                        </div>
                    <span class="text-xl font-bold text-gray-900 dark:text-white">DH Admin</span>
                        </div>
                    </div>
            <nav class="p-4 space-y-2">
                <a href="#dashboard" class="sidebar-link active">
                    <i class="fas fa-tachometer-alt w-5"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#products" class="sidebar-link">
                    <i class="fas fa-box w-5"></i>
                    <span>Products</span>
                </a>
                <a href="#landing-pages" class="sidebar-link">
                    <i class="fas fa-rocket w-5"></i>
                    <span>Landing Pages</span>
                </a>
                <a href="index.html" class="sidebar-link">
                    <i class="fas fa-home w-5"></i>
                    <span>View Site</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <!-- Top Navigation -->
            <header class="h-20 bg-white dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700 flex items-center justify-between px-6">
                <button class="lg:hidden text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <div class="flex items-center space-x-4">
                    <button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                            <i class="fas fa-moon dark:hidden text-lg"></i>
                            <i class="fas fa-sun hidden dark:block text-lg"></i>
                        </button>
                    <div class="h-8 w-8 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center">
                        <i class="fas fa-user text-primary-600 dark:text-primary-400"></i>
                </div>
            </div>
        </header>

            <!-- Dashboard Content -->
            <main class="flex-1 overflow-auto p-6">
                <!-- Stats Overview -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Total Products</p>
                                <h3 class="text-2xl font-bold text-gray-900 dark:text-white mt-1" id="total-products">0</h3>
                </div>
                            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-box text-blue-600 dark:text-blue-400 text-xl"></i>
            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Landing Pages</p>
                                <h3 class="text-2xl font-bold text-gray-900 dark:text-white mt-1" id="total-landing-pages">0</h3>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-rocket text-purple-600 dark:text-purple-400 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Features Added</p>
                                <h3 class="text-2xl font-bold text-gray-900 dark:text-white mt-1" id="total-features">0</h3>
                            </div>
                            <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-star text-green-600 dark:text-green-400 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Specifications</p>
                                <h3 class="text-2xl font-bold text-gray-900 dark:text-white mt-1" id="total-specs">0</h3>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-cogs text-orange-600 dark:text-orange-400 text-xl"></i>
                            </div>
                        </div>
                </div>
            </div>

                <!-- Shopify Connection Card -->
                <div class="dashboard-card mb-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-primary-100 dark:bg-primary-900/30 rounded-lg flex items-center justify-center">
                        <i class="fas fa-plug text-primary-600 dark:text-primary-400 text-xl"></i>
                    </div>
                    <div>
                                <h2 class="text-xl font-bold text-gray-900 dark:text-white">Shopify Connection</h2>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Manage your Shopify product data</p>
                    </div>
                </div>
                        <button id="connect-shopify" class="px-4 py-2 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-lg hover:from-primary-700 hover:to-primary-800 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                        <i class="fas fa-plug mr-2"></i>Connect to Shopify
                    </button>
                    </div>
                    <div id="connection-status" class="mb-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-info-circle text-yellow-600 dark:text-yellow-400 mr-3"></i>
                            <span class="text-yellow-800 dark:text-yellow-200">Click "Connect to Shopify" to load your products</span>
                        </div>
                    </div>
                    <div id="firebase-status" class="mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-database text-blue-600 dark:text-blue-400 mr-3"></i>
                            <span class="text-blue-800 dark:text-blue-200">Firebase: <span id="firebase-status-text">Checking...</span></span>
                        </div>
                    </div>
                   
                    <div id="connection-loading" class="hidden flex items-center">
                        <div class="loading-spinner"></div>
                        <span class="ml-2 text-gray-600 dark:text-gray-400">Loading products...</span>
                </div>
            </div>

                <!-- Product Management Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Product Selection -->
                    <div id="product-selection" class="dashboard-card hidden">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-box text-green-600 dark:text-green-400"></i>
                    </div>
                    <div>
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white">Select Product</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Choose a product to manage</p>
                    </div>
                </div>
                        <select id="product-select" class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all">
                    <option value="">Choose a product...</option>
                </select>
            </div>

                    <!-- Content Preview -->
                    <div id="preview-section" class="dashboard-card hidden">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-eye text-orange-600 dark:text-orange-400"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-gray-900 dark:text-white">Live Preview</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Content preview</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="bg-gray-50 dark:bg-slate-700 rounded-lg p-4">
                                <h4 class="font-bold text-sm mb-2 text-gray-900 dark:text-white">Key Features</h4>
                                <ul id="features-preview" class="space-y-2 text-sm"></ul>
                            </div>
                            <div class="bg-gray-50 dark:bg-slate-700 rounded-lg p-4">
                                <h4 class="font-bold text-sm mb-2 text-gray-900 dark:text-white">Technical Specifications</h4>
                                <div id="specs-preview" class="text-sm space-y-2"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Features and Specifications Management -->
                <div id="content-management" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Key Features Section -->
                    <div class="dashboard-card">
                        <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-star text-blue-600 dark:text-blue-400"></i>
                            </div>
                                <h2 class="text-lg font-bold text-gray-900 dark:text-white">Key Features</h2>
                        </div>
                            <button id="add-feature" class="px-3 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 transition-all duration-200 text-sm">
                                <i class="fas fa-plus mr-1"></i>Add
                        </button>
                    </div>
                        <div id="features-list" class="space-y-2 mb-4 max-h-96 overflow-y-auto"></div>
                        <button id="save-features" class="w-full px-4 py-2 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-lg hover:from-primary-700 hover:to-primary-800 transition-all duration-200">
                        <i class="fas fa-save mr-2"></i>Save Features
                    </button>
                </div>

                <!-- Technical Specifications Section -->
                    <div class="dashboard-card">
                        <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-cogs text-purple-600 dark:text-purple-400"></i>
                            </div>
                                <h2 class="text-lg font-bold text-gray-900 dark:text-white">Technical Specifications</h2>
                        </div>
                            <button id="add-spec" class="px-3 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 transition-all duration-200 text-sm">
                                <i class="fas fa-plus mr-1"></i>Add
                        </button>
                    </div>
                        <div id="specs-list" class="space-y-2 mb-4 max-h-96 overflow-y-auto"></div>
                        <button id="save-specs" class="w-full px-4 py-2 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-lg hover:from-primary-700 hover:to-primary-800 transition-all duration-200">
                        <i class="fas fa-save mr-2"></i>Save Specifications
                    </button>
                </div>
            </div>

                <!-- Landing Pages Section -->
                <div class="dashboard-card">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-rocket text-purple-600 dark:text-purple-400 text-xl"></i>
                        </div>
                        <div>
                                <h2 class="text-xl font-bold text-gray-900 dark:text-white">Landing Pages</h2>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Create and manage landing pages</p>
                        </div>
                    </div>
                        <div class="flex space-x-3">
                            <button id="test-landing" class="px-4 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 transition-all duration-200 text-sm">
                                <i class="fas fa-flask mr-1"></i>Test
                    </button>
                            <button id="create-landing" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-lg hover:from-purple-700 hover:to-purple-800 transition-all duration-200 text-sm">
                                <i class="fas fa-plus mr-1"></i>Create New
                    </button>
                    </div>
                </div>

                <!-- Create Landing Page Form -->
                    <div id="create-landing-form" class="hidden mb-6">
                        <div class="bg-gray-50 dark:bg-slate-700 rounded-lg p-6">
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Create New Landing Page</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Page Name</label>
                                    <input type="text" id="landing-name" class="w-full p-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white">
                        </div>
                        <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">URL Slug</label>
                                    <input type="text" id="landing-slug" class="w-full p-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-white">
                        </div>
                    </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Select Products</label>
                                <div id="products-selection-container" class="grid grid-cols-2 md:grid-cols-3 gap-3 max-h-60 overflow-y-auto p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800"></div>
                        </div>
                    <div class="flex justify-end space-x-3">
                                <button id="cancel-landing" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">Cancel</button>
                                <button id="save-landing" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-lg hover:from-purple-700 hover:to-purple-800 transition-all duration-200">
                                    <i class="fas fa-save mr-1"></i>Create
                        </button>
                    </div>
                </div>
            </div>

                    <!-- Landing Pages List -->
                    <div id="landing-pages-container" class="space-y-4"></div>
                        </div>
            </main>
                    </div>
    </div>

    <!-- Modals -->
    <!-- Feature Modal -->
    <div id="feature-modal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-lg font-semibold mb-4">Add Feature</h3>
            <input type="text" id="feature-input" placeholder="Enter feature description" class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white mb-3">
            
            <!-- Icon Selection -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Select Icon:</label>
                <div class="grid grid-cols-6 gap-2 max-h-60 overflow-y-auto border border-gray-300 dark:border-slate-600 rounded-lg p-2">
                    <!-- CPU & Processing -->
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-microchip">
                        <i class="fas fa-microchip text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-server">
                        <i class="fas fa-server text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-cogs">
                        <i class="fas fa-cogs text-lg"></i>
                    </button>
                    
                    <!-- Memory & Storage -->
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-memory">
                        <i class="fas fa-memory text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-hdd">
                        <i class="fas fa-hdd text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-database">
                        <i class="fas fa-database text-lg"></i>
                    </button>
                    
                    <!-- Battery & Power -->
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-battery-full">
                        <i class="fas fa-battery-full text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-bolt">
                        <i class="fas fa-bolt text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-plug">
                        <i class="fas fa-plug text-lg"></i>
                    </button>
                    
                    <!-- Connectivity -->
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-wifi">
                        <i class="fas fa-wifi text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-bluetooth">
                        <i class="fas fa-bluetooth text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-satellite">
                        <i class="fas fa-satellite text-lg"></i>
                    </button>
                    
                    <!-- Display & Screen -->
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-mobile-alt">
                        <i class="fas fa-mobile-alt text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-tv">
                        <i class="fas fa-tv text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-desktop">
                        <i class="fas fa-desktop text-lg"></i>
                    </button>
                    
                    <!-- Camera & Media -->
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-camera">
                        <i class="fas fa-camera text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-video">
                        <i class="fas fa-video text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-headphones">
                        <i class="fas fa-headphones text-lg"></i>
                    </button>
                    
                    <!-- Performance & Speed -->
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-tachometer-alt">
                        <i class="fas fa-tachometer-alt text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-rocket">
                        <i class="fas fa-rocket text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-sync">
                        <i class="fas fa-sync text-lg"></i>
                    </button>
                    
                    <!-- Security & Protection -->
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-shield-alt">
                        <i class="fas fa-shield-alt text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-lock">
                        <i class="fas fa-lock text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-fingerprint">
                        <i class="fas fa-fingerprint text-lg"></i>
                    </button>
                    
                    <!-- Quality & Premium -->
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-star">
                        <i class="fas fa-star text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-gem">
                        <i class="fas fa-gem text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-crown">
                        <i class="fas fa-crown text-lg"></i>
                    </button>
                    
                    <!-- Cooling & Temperature -->
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-snowflake">
                        <i class="fas fa-snowflake text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-thermometer-half">
                        <i class="fas fa-thermometer-half text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-fan">
                        <i class="fas fa-fan text-lg"></i>
                    </button>
                    
                    <!-- Gaming & Entertainment -->
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-gamepad">
                        <i class="fas fa-gamepad text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-play">
                        <i class="fas fa-play text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-music">
                        <i class="fas fa-music text-lg"></i>
                    </button>
                    
                    <!-- AI & Smart Features -->
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-brain">
                        <i class="fas fa-brain text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-robot">
                        <i class="fas fa-robot text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-magic">
                        <i class="fas fa-magic text-lg"></i>
                    </button>
                    
                    <!-- Build Quality -->
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-hammer">
                        <i class="fas fa-hammer text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-cube">
                        <i class="fas fa-cube text-lg"></i>
                    </button>
                    <button type="button" class="icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-diamond">
                        <i class="fas fa-diamond text-lg"></i>
                    </button>
                </div>
                <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                    Selected: <span id="selected-icon-display">None</span>
                </div>
            </div>
            
            <div class="flex justify-end space-x-2">
                <button id="cancel-feature" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">Cancel</button>
                <button id="save-feature" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors">Add Feature</button>
            </div>
        </div>
    </div>

    <!-- Specification Modal -->
    <div id="spec-modal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-lg font-semibold mb-4">Add Specification</h3>
            <input type="text" id="spec-category" placeholder="Category (e.g., Display, Processor)" class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white mb-3">
            <input type="text" id="spec-value" placeholder="Value (e.g., 6.7-inch OLED)" class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white mb-4">
            <div class="flex justify-end space-x-2">
                <button id="cancel-spec" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">Cancel</button>
                <button id="save-spec" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors">Add Specification</button>
            </div>
        </div>
    </div>

    <!-- Edit Feature Modal -->
    <div id="edit-feature-modal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-lg font-semibold mb-4">Edit Feature</h3>
            <input type="text" id="edit-feature-input" placeholder="Enter feature description" class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white mb-3">
            
            <!-- Icon Selection -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Select Icon:</label>
                <div class="grid grid-cols-6 gap-2 max-h-60 overflow-y-auto border border-gray-300 dark:border-slate-600 rounded-lg p-2">
                    <!-- CPU & Processing -->
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-microchip">
                        <i class="fas fa-microchip text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-server">
                        <i class="fas fa-server text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-cogs">
                        <i class="fas fa-cogs text-lg"></i>
                    </button>
                    
                    <!-- Memory & Storage -->
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-memory">
                        <i class="fas fa-memory text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-hdd">
                        <i class="fas fa-hdd text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-database">
                        <i class="fas fa-database text-lg"></i>
                    </button>
                    
                    <!-- Battery & Power -->
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-battery-full">
                        <i class="fas fa-battery-full text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-bolt">
                        <i class="fas fa-bolt text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-plug">
                        <i class="fas fa-plug text-lg"></i>
                    </button>
                    
                    <!-- Connectivity -->
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-wifi">
                        <i class="fas fa-wifi text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-bluetooth">
                        <i class="fas fa-bluetooth text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-satellite">
                        <i class="fas fa-satellite text-lg"></i>
                    </button>
                    
                    <!-- Display & Screen -->
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-mobile-alt">
                        <i class="fas fa-mobile-alt text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-tv">
                        <i class="fas fa-tv text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-desktop">
                        <i class="fas fa-desktop text-lg"></i>
                    </button>
                    
                    <!-- Camera & Media -->
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-camera">
                        <i class="fas fa-camera text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-video">
                        <i class="fas fa-video text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-headphones">
                        <i class="fas fa-headphones text-lg"></i>
                    </button>
                    
                    <!-- Performance & Speed -->
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-tachometer-alt">
                        <i class="fas fa-tachometer-alt text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-rocket">
                        <i class="fas fa-rocket text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-sync">
                        <i class="fas fa-sync text-lg"></i>
                    </button>
                    
                    <!-- Security & Protection -->
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-shield-alt">
                        <i class="fas fa-shield-alt text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-lock">
                        <i class="fas fa-lock text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-fingerprint">
                        <i class="fas fa-fingerprint text-lg"></i>
                    </button>
                    
                    <!-- Quality & Premium -->
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-star">
                        <i class="fas fa-star text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-gem">
                        <i class="fas fa-gem text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-crown">
                        <i class="fas fa-crown text-lg"></i>
                    </button>
                    
                    <!-- Cooling & Temperature -->
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-snowflake">
                        <i class="fas fa-snowflake text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-thermometer-half">
                        <i class="fas fa-thermometer-half text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-fan">
                        <i class="fas fa-fan text-lg"></i>
                    </button>
                    
                    <!-- Gaming & Entertainment -->
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-gamepad">
                        <i class="fas fa-gamepad text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-play">
                        <i class="fas fa-play text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-music">
                        <i class="fas fa-music text-lg"></i>
                    </button>
                    
                    <!-- AI & Smart Features -->
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-brain">
                        <i class="fas fa-brain text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-robot">
                        <i class="fas fa-robot text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-magic">
                        <i class="fas fa-magic text-lg"></i>
                    </button>
                    
                    <!-- Build Quality -->
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-hammer">
                        <i class="fas fa-hammer text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-cube">
                        <i class="fas fa-cube text-lg"></i>
                    </button>
                    <button type="button" class="edit-icon-option p-2 text-center border border-gray-200 dark:border-slate-600 rounded hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors" data-icon="fa-diamond">
                        <i class="fas fa-diamond text-lg"></i>
                    </button>
                </div>
                <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                    Selected: <span id="edit-selected-icon-display">None</span>
                </div>
            </div>
            
            <div class="flex justify-end space-x-2">
                <button id="cancel-edit-feature" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">Cancel</button>
                <button id="save-edit-feature" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors">Update Feature</button>
            </div>
        </div>
    </div>

    <!-- Edit Specification Modal -->
    <div id="edit-spec-modal" class="modal hidden">
        <div class="modal-content">
            <h3 class="text-lg font-semibold mb-4">Edit Specification</h3>
            <input type="text" id="edit-spec-category" placeholder="Category (e.g., Display, Processor)" class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white mb-3">
            <input type="text" id="edit-spec-value" placeholder="Value (e.g., 6.7-inch OLED)" class="w-full p-3 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white mb-4">
            <div class="flex justify-end space-x-2">
                <button id="cancel-edit-spec" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">Cancel</button>
                <button id="save-edit-spec" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors">Update Specification</button>
            </div>
        </div>
    </div>

    <script>
        // Shopify Configuration
        const SHOPIFY_CONFIG = {
            domain: 'kwr3tv-ax.myshopify.com',
            accessToken: 'e318cfe2b56703f779f113ed17e8459c',
            apiVersion: '2024-01'
        };

        // Global variables
        let products = [];
        let selectedProduct = null;
        let features = [];
        let specifications = [];

        // DOM elements
        const connectBtn = document.getElementById('connect-shopify');
        const connectionLoading = document.getElementById('connection-loading');
        const connectionStatus = document.getElementById('connection-status');
        const productSelection = document.getElementById('product-selection');
        const productSelect = document.getElementById('product-select');
        const contentManagement = document.getElementById('content-management');
        const previewSection = document.getElementById('preview-section');

        // Connect to Shopify
        connectBtn.addEventListener('click', async () => {
            try {
                connectBtn.disabled = true;
                connectionLoading.classList.remove('hidden');
                
                // First test the connection with a simple query
                const testQuery = `
                    query {
                        shop {
                            name
                            primaryDomain {
                                url
                            }
                        }
                    }
                `;

                console.log('🔍 Testing Shopify connection...');
                
                const testResponse = await fetch(`https://${SHOPIFY_CONFIG.domain}/api/${SHOPIFY_CONFIG.apiVersion}/graphql.json`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Shopify-Storefront-Access-Token': SHOPIFY_CONFIG.accessToken
                    },
                    body: JSON.stringify({ query: testQuery })
                });

                if (!testResponse.ok) {
                    throw new Error(`HTTP error! status: ${testResponse.status}`);
                }

                const testData = await testResponse.json();
                console.log('Shopify test response:', testData);

                if (testData.errors) {
                    console.error('Shopify API errors:', testData.errors);
                    throw new Error(`Shopify API errors: ${testData.errors.map(e => e.message).join(', ')}`);
                }

                if (!testData.data || !testData.data.shop) {
                    throw new Error('Invalid response from Shopify API');
                }

                console.log('✅ Shopify connection test successful!');
                
                // Now fetch products
                const query = `
                    query {
                        products(first: 100) {
                            edges {
                                node {
                                    id
                                    title
                                    handle
                                    description
                                    productType
                                    tags
                                    availableForSale
                                    priceRange {
                                        minVariantPrice {
                                            amount
                                            currencyCode
                                        }
                                    }
                                    images(first: 1) {
                                        edges {
                                            node {
                                                url
                                                altText
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                `;

                const response = await fetch(`https://${SHOPIFY_CONFIG.domain}/api/${SHOPIFY_CONFIG.apiVersion}/graphql.json`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Shopify-Storefront-Access-Token': SHOPIFY_CONFIG.accessToken
                    },
                    body: JSON.stringify({ query })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('📦 Shopify products response:', data);
                
                if (data.errors) {
                    console.error('❌ Shopify API errors:', data.errors);
                    throw new Error(`Shopify API errors: ${data.errors.map(e => e.message).join(', ')}`);
                }

                if (!data.data || !data.data.products) {
                    throw new Error('No products data received from Shopify');
                }

                products = data.data.products.edges.map(edge => edge.node);
                console.log(`✅ Loaded ${products.length} products from Shopify`);
                
                // Populate product select
                productSelect.innerHTML = '<option value="">Choose a product...</option>';
                products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.handle;
                    option.textContent = product.title;
                    productSelect.appendChild(option);
                });

                // Show product selection
                productSelection.classList.remove('hidden');
                connectionStatus.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-600 dark:text-green-400 mr-2"></i>
                        <span class="text-green-800 dark:text-green-200">Connected to Shopify! ${products.length} products loaded.</span>
                    </div>
                `;
                connectionStatus.className = 'mb-6 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg';

            } catch (error) {
                console.error('❌ Error connecting to Shopify:', error);
                connectionStatus.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-red-600 dark:text-red-400 mr-2"></i>
                        <span class="text-red-800 dark:text-red-200">Failed to connect to Shopify: ${error.message}</span>
                    </div>
                `;
                connectionStatus.className = 'mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg';
            } finally {
                connectBtn.disabled = false;
                connectionLoading.classList.add('hidden');
            }
        });

        // Product selection
        productSelect.addEventListener('change', async () => {
            const productHandle = productSelect.value;
            if (!productHandle) {
                contentManagement.classList.add('hidden');
                previewSection.classList.add('hidden');
                return;
            }

            selectedProduct = products.find(p => p.handle === productHandle);
            contentManagement.classList.remove('hidden');
            previewSection.classList.remove('hidden');

            // Load existing content from Firestore
            await loadProductContent(productHandle);
        });

        // Load product content from Firestore
        async function loadProductContent(productHandle) {
            try {
                if (!window.db) {
                    console.error('Firebase is not initialized');
                    features = [];
                    specifications = [];
                    renderFeatures();
                    renderSpecifications();
                    renderPreview();
                    return;
                }
                
                const featuresDocRef = doc(window.db, 'productFeatures', productHandle);
                const specsDocRef = doc(window.db, 'productSpecs', productHandle);
                
                const featuresDoc = await getDoc(featuresDocRef);
                const specsDoc = await getDoc(specsDocRef);

                features = featuresDoc.exists() ? featuresDoc.data().features || [] : [];
                specifications = specsDoc.exists() ? specsDoc.data().specifications || [] : [];

                renderFeatures();
                renderSpecifications();
                renderPreview();
            } catch (error) {
                console.error('Error loading content:', error);
                features = [];
                specifications = [];
                renderFeatures();
                renderSpecifications();
                renderPreview();
            }
        }

        // Feature management
        let selectedIcon = null;
        
        document.getElementById('add-feature').addEventListener('click', () => {
            document.getElementById('feature-modal').classList.remove('hidden');
            document.getElementById('feature-input').focus();
            selectedIcon = null;
            document.getElementById('selected-icon-display').textContent = 'None';
            // Reset icon selection
            document.querySelectorAll('.icon-option').forEach(btn => {
                btn.classList.remove('bg-primary-100', 'border-primary-500');
            });
        });

        // Icon selection
        document.querySelectorAll('.icon-option').forEach(button => {
            button.addEventListener('click', () => {
                // Remove previous selection
                document.querySelectorAll('.icon-option').forEach(btn => {
                    btn.classList.remove('bg-primary-100', 'border-primary-500');
                });
                
                // Add selection to clicked button
                button.classList.add('bg-primary-100', 'border-primary-500');
                selectedIcon = button.dataset.icon;
                document.getElementById('selected-icon-display').textContent = selectedIcon;
            });
        });

        document.getElementById('save-feature').addEventListener('click', () => {
            const input = document.getElementById('feature-input');
            const featureText = input.value.trim();
            
            if (featureText) {
                features.push({ 
                    text: featureText,
                    icon: selectedIcon || 'fa-star' // Default icon if none selected
                });
                renderFeatures();
                renderPreview();
                input.value = '';
                selectedIcon = null;
                document.getElementById('selected-icon-display').textContent = 'None';
                document.getElementById('feature-modal').classList.add('hidden');
            }
        });

        document.getElementById('cancel-feature').addEventListener('click', () => {
            document.getElementById('feature-input').value = '';
            selectedIcon = null;
            document.getElementById('selected-icon-display').textContent = 'None';
            document.getElementById('feature-modal').classList.add('hidden');
        });

        // Specification management
        document.getElementById('add-spec').addEventListener('click', () => {
            document.getElementById('spec-modal').classList.remove('hidden');
            document.getElementById('spec-category').focus();
        });

        document.getElementById('save-spec').addEventListener('click', () => {
            const categoryInput = document.getElementById('spec-category');
            const valueInput = document.getElementById('spec-value');
            const category = categoryInput.value.trim();
            const value = valueInput.value.trim();
            
            if (category && value) {
                specifications.push({ category, value });
                renderSpecifications();
                renderPreview();
                categoryInput.value = '';
                valueInput.value = '';
                document.getElementById('spec-modal').classList.add('hidden');
            }
        });

        document.getElementById('cancel-spec').addEventListener('click', () => {
            document.getElementById('spec-category').value = '';
            document.getElementById('spec-value').value = '';
            document.getElementById('spec-modal').classList.add('hidden');
        });

        // Edit feature modal event listeners
        document.querySelectorAll('.edit-icon-option').forEach(button => {
            button.addEventListener('click', () => {
                // Remove previous selection
                document.querySelectorAll('.edit-icon-option').forEach(btn => {
                    btn.classList.remove('bg-primary-100', 'border-primary-500');
                });
                
                // Add selection to clicked button
                button.classList.add('bg-primary-100', 'border-primary-500');
                editSelectedIcon = button.dataset.icon;
                document.getElementById('edit-selected-icon-display').textContent = editSelectedIcon;
            });
        });

        document.getElementById('save-edit-feature').addEventListener('click', () => {
            const input = document.getElementById('edit-feature-input');
            const featureText = input.value.trim();
            
            if (featureText && editingFeatureIndex >= 0) {
                features[editingFeatureIndex] = { 
                    text: featureText,
                    icon: editSelectedIcon || 'fa-star'
                };
                renderFeatures();
                renderPreview();
                
                // Reset and close modal
                input.value = '';
                editSelectedIcon = null;
                document.getElementById('edit-selected-icon-display').textContent = 'None';
                document.getElementById('edit-feature-modal').classList.add('hidden');
                editingFeatureIndex = -1;
            }
        });

        document.getElementById('cancel-edit-feature').addEventListener('click', () => {
            document.getElementById('edit-feature-input').value = '';
            editSelectedIcon = null;
            document.getElementById('edit-selected-icon-display').textContent = 'None';
            document.getElementById('edit-feature-modal').classList.add('hidden');
            editingFeatureIndex = -1;
        });

        // Edit specification modal event listeners
        document.getElementById('save-edit-spec').addEventListener('click', () => {
            const categoryInput = document.getElementById('edit-spec-category');
            const valueInput = document.getElementById('edit-spec-value');
            const category = categoryInput.value.trim();
            const value = valueInput.value.trim();
            
            if (category && value && editingSpecIndex >= 0) {
                specifications[editingSpecIndex] = { category, value };
                renderSpecifications();
                renderPreview();
                
                // Reset and close modal
                categoryInput.value = '';
                valueInput.value = '';
                document.getElementById('edit-spec-modal').classList.add('hidden');
                editingSpecIndex = -1;
            }
        });

        document.getElementById('cancel-edit-spec').addEventListener('click', () => {
            document.getElementById('edit-spec-category').value = '';
            document.getElementById('edit-spec-value').value = '';
            document.getElementById('edit-spec-modal').classList.add('hidden');
            editingSpecIndex = -1;
        });

        // Save features to Firestore
        document.getElementById('save-features').addEventListener('click', async () => {
            if (!selectedProduct) {
                alert('Please select a product first.');
                return;
            }
            
            const saveBtn = document.getElementById('save-features');
            const originalText = saveBtn.innerHTML;
            
            try {
                // Show loading state
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';
                
                const featuresDocRef = doc(window.db, 'productFeatures', selectedProduct.handle);
                await setDoc(featuresDocRef, {
                    features: features,
                    productId: selectedProduct.id,
                    productTitle: selectedProduct.title,
                    updatedAt: serverTimestamp()
                });
                
                // Show success message
                saveBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Saved!';
                saveBtn.classList.remove('from-primary-600', 'to-primary-700');
                saveBtn.classList.add('from-green-600', 'to-green-700');
                
                setTimeout(() => {
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = originalText;
                    saveBtn.classList.remove('from-green-600', 'to-green-700');
                    saveBtn.classList.add('from-primary-600', 'to-primary-700');
                }, 2000);
                
            } catch (error) {
                console.error('Error saving features:', error);
                saveBtn.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Error!';
                saveBtn.classList.remove('from-primary-600', 'to-primary-700');
                saveBtn.classList.add('from-red-600', 'to-red-700');
                
                setTimeout(() => {
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = originalText;
                    saveBtn.classList.remove('from-red-600', 'to-red-700');
                    saveBtn.classList.add('from-primary-600', 'to-primary-700');
                }, 2000);
                
                alert('Error saving features. Please try again.');
            }
        });

        // Save specifications to Firestore
        document.getElementById('save-specs').addEventListener('click', async () => {
            if (!selectedProduct) {
                alert('Please select a product first.');
                return;
            }
            
            const saveBtn = document.getElementById('save-specs');
            const originalText = saveBtn.innerHTML;
            
            try {
                // Show loading state
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';
                
                const specsDocRef = doc(window.db, 'productSpecs', selectedProduct.handle);
                await setDoc(specsDocRef, {
                    specifications: specifications,
                    productId: selectedProduct.id,
                    productTitle: selectedProduct.title,
                    updatedAt: serverTimestamp()
                });
                
                // Show success message
                saveBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Saved!';
                saveBtn.classList.remove('from-primary-600', 'to-primary-700');
                saveBtn.classList.add('from-green-600', 'to-green-700');
                
                setTimeout(() => {
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = originalText;
                    saveBtn.classList.remove('from-green-600', 'to-green-700');
                    saveBtn.classList.add('from-primary-600', 'to-primary-700');
                }, 2000);
                
            } catch (error) {
                console.error('Error saving specifications:', error);
                saveBtn.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Error!';
                saveBtn.classList.remove('from-primary-600', 'to-primary-700');
                saveBtn.classList.add('from-red-600', 'to-red-700');
                
                setTimeout(() => {
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = originalText;
                    saveBtn.classList.remove('from-red-600', 'to-red-700');
                    saveBtn.classList.add('from-primary-600', 'to-primary-700');
                }, 2000);
                
                alert('Error saving specifications. Please try again.');
            }
        });

        // Render functions
        function renderFeatures() {
            const container = document.getElementById('features-list');
            container.innerHTML = features.length === 0 ? 
                '<div class="text-center py-8"><i class="fas fa-inbox text-4xl text-slate-400 mb-4"></i><p class="text-slate-500 dark:text-slate-400">No features added yet. Click "Add Feature" to get started.</p></div>' :
                features.map((feature, index) => `
                    <div class="flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-slate-700 dark:to-slate-600 rounded-lg border border-gray-200 dark:border-slate-600 shadow-sm hover:shadow-md transition-all duration-200">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-primary-100 dark:bg-primary-900/30 rounded-lg flex items-center justify-center">
                                <i class="fas ${feature.icon || 'fa-star'} text-primary-600 dark:text-primary-400"></i>
                            </div>
                            <span class="text-sm font-medium text-gray-900 dark:text-white">${feature.text}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="editFeature(${index})" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 p-2 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors" title="Edit Feature">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="removeFeature(${index})" class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors" title="Delete Feature">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
        }

        function renderSpecifications() {
            const container = document.getElementById('specs-list');
            container.innerHTML = specifications.length === 0 ? 
                '<div class="text-center py-8"><i class="fas fa-inbox text-4xl text-slate-400 mb-4"></i><p class="text-slate-500 dark:text-slate-400">No specifications added yet. Click "Add Spec" to get started.</p></div>' :
                specifications.map((spec, index) => `
                    <div class="flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-slate-700 dark:to-slate-600 rounded-lg border border-gray-200 dark:border-slate-600 shadow-sm hover:shadow-md transition-all duration-200">
                        <div class="text-sm">
                            <span class="font-semibold text-gray-900 dark:text-white">${spec.category}:</span>
                            <span class="text-gray-700 dark:text-gray-300"> ${spec.value}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="editSpec(${index})" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 p-2 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors" title="Edit Specification">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="removeSpec(${index})" class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors" title="Delete Specification">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
        }

        function renderPreview() {
            // Features preview
            const featuresPreview = document.getElementById('features-preview');
            featuresPreview.innerHTML = features.length === 0 ? 
                '<li class="text-slate-500 dark:text-slate-400 flex items-center justify-center py-4"><i class="fas fa-inbox mr-2"></i>No features available</li>' :
                features.map(feature => `
                    <li class="flex items-center space-x-3 p-3 bg-white dark:bg-slate-600 rounded-lg shadow-sm">
                        <div class="w-6 h-6 bg-primary-100 dark:bg-primary-900/30 rounded-full flex items-center justify-center">
                            <i class="fas ${feature.icon || 'fa-star'} text-primary-600 dark:text-primary-400 text-xs"></i>
                        </div>
                        <span class="text-gray-900 dark:text-white">${feature.text}</span>
                    </li>
                `).join('');

            // Specifications preview
            const specsPreview = document.getElementById('specs-preview');
            specsPreview.innerHTML = specifications.length === 0 ? 
                '<p class="text-slate-500 dark:text-slate-400 flex items-center justify-center py-4"><i class="fas fa-inbox mr-2"></i>No specifications available</p>' :
                specifications.map(spec => `
                    <div class="p-3 bg-white dark:bg-slate-600 rounded-lg shadow-sm">
                        <span class="font-semibold text-gray-900 dark:text-white">${spec.category}:</span>
                        <span class="text-gray-700 dark:text-gray-300"> ${spec.value}</span>
                    </div>
                `).join('');
        }

        // Remove functions
        function removeFeature(index) {
            features.splice(index, 1);
            renderFeatures();
            renderPreview();
        }

        function removeSpec(index) {
            specifications.splice(index, 1);
            renderSpecifications();
            renderPreview();
        }

        // Edit functions
        let editingFeatureIndex = -1;
        let editingSpecIndex = -1;
        let editSelectedIcon = null;

        function editFeature(index) {
            editingFeatureIndex = index;
            const feature = features[index];
            
            // Populate the edit modal
            document.getElementById('edit-feature-input').value = feature.text;
            editSelectedIcon = feature.icon || 'fa-star';
            document.getElementById('edit-selected-icon-display').textContent = editSelectedIcon;
            
            // Reset icon selection
            document.querySelectorAll('.edit-icon-option').forEach(btn => {
                btn.classList.remove('bg-primary-100', 'border-primary-500');
                if (btn.dataset.icon === editSelectedIcon) {
                    btn.classList.add('bg-primary-100', 'border-primary-500');
                }
            });
            
            // Show the edit modal
            document.getElementById('edit-feature-modal').classList.remove('hidden');
            document.getElementById('edit-feature-input').focus();
        }

        function editSpec(index) {
            editingSpecIndex = index;
            const spec = specifications[index];
            
            // Populate the edit modal
            document.getElementById('edit-spec-category').value = spec.category;
            document.getElementById('edit-spec-value').value = spec.value;
            
            // Show the edit modal
            document.getElementById('edit-spec-modal').classList.remove('hidden');
            document.getElementById('edit-spec-category').focus();
        }

        // Theme toggle
        document.getElementById('theme-toggle').addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
        });

        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.add('hidden');
                
                // Reset edit states when closing modals
                if (e.target.id === 'edit-feature-modal') {
                    editingFeatureIndex = -1;
                    editSelectedIcon = null;
                    document.getElementById('edit-feature-input').value = '';
                    document.getElementById('edit-selected-icon-display').textContent = 'None';
                } else if (e.target.id === 'edit-spec-modal') {
                    editingSpecIndex = -1;
                    document.getElementById('edit-spec-category').value = '';
                    document.getElementById('edit-spec-value').value = '';
                }
            }
        });

        // Landing Page Maker Functionality
        let landingPages = [];
        let selectedProductsForLanding = new Set();

        // DOM elements for landing page maker
        const createLandingBtn = document.getElementById('create-landing');
        const createLandingForm = document.getElementById('create-landing-form');
        const cancelLandingBtn = document.getElementById('cancel-landing');
        const saveLandingBtn = document.getElementById('save-landing');
        const landingPagesContainer = document.getElementById('landing-pages-container');

        // Create landing page button
        createLandingBtn.addEventListener('click', () => {
            createLandingForm.classList.remove('hidden');
            loadProductsForLanding();
        });

        // Cancel landing page creation
        cancelLandingBtn.addEventListener('click', () => {
            createLandingForm.classList.add('hidden');
            resetLandingForm();
        });

        // Save landing page
        saveLandingBtn.addEventListener('click', async () => {
            const landingName = document.getElementById('landing-name').value.trim();
            const landingSlug = document.getElementById('landing-slug').value.trim();

            if (!landingName) {
                alert('Please enter a landing page name.');
                return;
            }

            if (!landingSlug) {
                alert('Please enter a URL slug.');
                return;
            }

            if (products.length === 0) {
                alert('Please connect to Shopify first to create landing pages.');
                return;
            }

            if (selectedProductsForLanding.size === 0) {
                alert('Please select at least one product.');
                return;
            }

            // Check if slug already exists
            const existingLanding = landingPages.find(lp => lp.slug === landingSlug);
            if (existingLanding) {
                alert('A landing page with this URL slug already exists. Please choose a different slug.');
                return;
            }

            try {
                saveLandingBtn.disabled = true;
                saveLandingBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Creating...';

                const newLandingPage = {
                    id: Date.now().toString(),
                    name: landingName,
                    slug: landingSlug,
                    products: Array.from(selectedProductsForLanding),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                // Save to localStorage first (for admin users)
                try {
                    const existingLandingPages = JSON.parse(localStorage.getItem('landingPages') || '[]');
                    existingLandingPages.push(newLandingPage);
                    localStorage.setItem('landingPages', JSON.stringify(existingLandingPages));
                    console.log('Saved to localStorage successfully');
                } catch (error) {
                    console.error('Error saving to localStorage:', error);
                }

                // Add to local array
                landingPages.push(newLandingPage);
                
                // Save to Firebase (this is the main storage now)
                if (window.db) {
                    try {
                        const landingDocRef = doc(window.db, 'landingPages', newLandingPage.id);
                        await setDoc(landingDocRef, {
                            ...newLandingPage,
                            createdAt: serverTimestamp(),
                            updatedAt: serverTimestamp()
                        });
                        console.log('Saved to Firebase successfully');
                    } catch (error) {
                        console.error('Error saving to Firebase:', error);
                        throw new Error('Failed to save to Firebase: ' + error.message);
                    }
                } else {
                    throw new Error('Firebase is not available. Please check your connection.');
                }
                
                // Render landing pages list
                renderLandingPages();

                // Reset form
                createLandingForm.classList.add('hidden');
                resetLandingForm();

                // Show success message
                saveLandingBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Created!';
                saveLandingBtn.classList.remove('from-purple-600', 'to-purple-700');
                saveLandingBtn.classList.add('from-green-600', 'to-green-700');

                setTimeout(() => {
                    saveLandingBtn.disabled = false;
                    saveLandingBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Create Landing Page';
                    saveLandingBtn.classList.remove('from-green-600', 'to-green-700');
                    saveLandingBtn.classList.add('from-purple-600', 'to-purple-700');
                }, 2000);

            } catch (error) {
                console.error('Error creating landing page:', error);
                alert('Error creating landing page: ' + error.message);
                saveLandingBtn.disabled = false;
                saveLandingBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Create Landing Page';
            }
        });



        // Test landing page button
        document.getElementById('test-landing').addEventListener('click', async () => {
            if (products.length === 0) {
                alert('Please connect to Shopify first to create a test landing page.');
                return;
            }

            try {
                // Create a test landing page with selected products
                const testLandingPage = {
                    id: 'test-' + Date.now(),
                    name: 'Test Landing Page',
                    slug: 'test-landing-page',
                    products: products.slice(0, 3).map(p => p.handle), // Use first 3 products
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                console.log('Creating test landing page:', testLandingPage);
                console.log('Selected products:', testLandingPage.products);

                // Save to localStorage
                try {
                    const existingLandingPages = JSON.parse(localStorage.getItem('landingPages') || '[]');
                    console.log('Existing landing pages:', existingLandingPages);
                    
                    // Remove any existing test landing page
                    const filteredLandingPages = existingLandingPages.filter(lp => lp.slug !== 'test-landing-page');
                    filteredLandingPages.push(testLandingPage);
                    
                    console.log('Saving to localStorage:', filteredLandingPages);
                    localStorage.setItem('landingPages', JSON.stringify(filteredLandingPages));
                    
                    // Add to local array
                    landingPages = landingPages.filter(lp => lp.slug !== 'test-landing-page');
                    landingPages.push(testLandingPage);
                    renderLandingPages();
                } catch (error) {
                    console.error('Error saving to localStorage:', error);
                }

                // Save to Firebase
                if (window.db) {
                    try {
                        const landingDocRef = doc(window.db, 'landingPages', testLandingPage.id);
                        await setDoc(landingDocRef, {
                            ...testLandingPage,
                            createdAt: serverTimestamp(),
                            updatedAt: serverTimestamp()
                        });
                        console.log('Test landing page saved to Firebase successfully');
                    } catch (error) {
                        console.error('Error saving test landing page to Firebase:', error);
                    }
                }
                
                // Open the test landing page
                window.open(`landing-page.html?page=test-landing-page`, '_blank');
                
                alert('Test landing page created and opened! Check the new tab.');
            } catch (error) {
                console.error('Error creating test landing page:', error);
                alert('Error creating test landing page.');
            }
        });

        // Add a new test button for custom product selection
        const testCustomBtn = document.createElement('button');
        testCustomBtn.id = 'test-custom-landing';
        testCustomBtn.className = 'px-4 py-2 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-lg hover:from-orange-700 hover:to-orange-800 transition-all duration-200 text-sm';
        testCustomBtn.innerHTML = '<i class="fas fa-flask mr-1"></i>Test Custom';
        testCustomBtn.addEventListener('click', async () => {
            if (products.length === 0) {
                alert('Please connect to Shopify first to create a test landing page.');
                return;
            }

            if (selectedProductsForLanding.size === 0) {
                alert('Please select products first. Use the "Create New Landing Page" form to select products.');
                return;
            }

            try {
                // Create a test landing page with selected products
                const testLandingPage = {
                    id: 'test-custom-' + Date.now(),
                    name: 'Custom Test Landing Page',
                    slug: 'test-custom-landing-page',
                    products: Array.from(selectedProductsForLanding),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                console.log('Creating custom test landing page:', testLandingPage);
                console.log('Selected products:', testLandingPage.products);

                // Save to localStorage
                try {
                    const existingLandingPages = JSON.parse(localStorage.getItem('landingPages') || '[]');
                    
                    // Remove any existing custom test landing page
                    const filteredLandingPages = existingLandingPages.filter(lp => lp.slug !== 'test-custom-landing-page');
                    filteredLandingPages.push(testLandingPage);
                    
                    localStorage.setItem('landingPages', JSON.stringify(filteredLandingPages));
                    
                    // Add to local array
                    landingPages = landingPages.filter(lp => lp.slug !== 'test-custom-landing-page');
                    landingPages.push(testLandingPage);
                    renderLandingPages();
                } catch (error) {
                    console.error('Error saving to localStorage:', error);
                }

                // Save to Firebase
                if (window.db) {
                    try {
                        const landingDocRef = doc(window.db, 'landingPages', testLandingPage.id);
                        await setDoc(landingDocRef, {
                            ...testLandingPage,
                            createdAt: serverTimestamp(),
                            updatedAt: serverTimestamp()
                        });
                        console.log('Custom test landing page saved to Firebase successfully');
                    } catch (error) {
                        console.error('Error saving custom test landing page to Firebase:', error);
                    }
                }
                
                // Open the test landing page
                window.open(`landing-page.html?page=test-custom-landing-page`, '_blank');
                
                alert('Custom test landing page created and opened! Check the new tab.');
            } catch (error) {
                console.error('Error creating custom test landing page:', error);
                alert('Error creating custom test landing page.');
            }
        });

        // Add the custom test button to the landing pages section
        document.querySelector('#create-landing').parentNode.appendChild(testCustomBtn);

        // Load products for landing page selection
        function loadProductsForLanding() {
            const productsContainer = document.getElementById('products-selection-container');
            productsContainer.innerHTML = '';

            if (products.length === 0) {
                productsContainer.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <i class="fas fa-exclamation-triangle text-4xl text-yellow-500 mb-4"></i>
                        <p class="text-yellow-700 dark:text-yellow-300 font-medium mb-2">No products available</p>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">Please connect to Shopify first to load your products.</p>
                        <button onclick="document.getElementById('connect-shopify').click()" class="mt-4 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors text-sm">
                            <i class="fas fa-plug mr-2"></i>Connect to Shopify
                        </button>
                    </div>
                `;
                return;
            }

            // Clear previous selections
            selectedProductsForLanding.clear();

            // Add select all/none buttons first
            const selectAllContainer = document.createElement('div');
            selectAllContainer.className = 'col-span-full flex space-x-2 mb-4';
            selectAllContainer.innerHTML = `
                <button id="select-all-products" class="px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700 transition-colors">
                    Select All
                </button>
                <button id="deselect-all-products" class="px-3 py-1 bg-gray-600 text-white rounded text-xs hover:bg-gray-700 transition-colors">
                    Deselect All
                </button>
                <span id="selected-count" class="px-3 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded text-xs">
                    0 selected
                </span>
            `;
            productsContainer.appendChild(selectAllContainer);

            // Add loading placeholders first
            const loadingPlaceholders = [
                { icon: 'fa-mobile-alt', name: 'Loading...', type: 'Smartphone' },
                { icon: 'fa-laptop', name: 'Loading...', type: 'Laptop' },
                { icon: 'fa-tablet-alt', name: 'Loading...', type: 'Tablet' },
                { icon: 'fa-headphones', name: 'Loading...', type: 'Accessories' },
                { icon: 'fa-watch', name: 'Loading...', type: 'Smartwatch' },
                { icon: 'fa-camera', name: 'Loading...', type: 'Camera' }
            ];

            loadingPlaceholders.forEach((placeholder, index) => {
                const productCard = document.createElement('div');
                productCard.className = 'border border-gray-200 dark:border-slate-600 rounded-lg p-4 bg-white dark:bg-slate-700 hover:shadow-md transition-all duration-200 cursor-pointer';
                productCard.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-4 h-4 bg-gray-300 dark:bg-slate-500 rounded animate-pulse"></div>
                        <div class="flex-1">
                            <div class="h-4 bg-gray-300 dark:bg-slate-500 rounded animate-pulse mb-2"></div>
                            <div class="h-3 bg-gray-200 dark:bg-slate-600 rounded animate-pulse w-2/3"></div>
                        </div>
                    </div>
                `;
                productsContainer.appendChild(productCard);
            });

            // Replace placeholders with actual products after a short delay
            setTimeout(() => {
                // Clear loading placeholders
                const placeholders = productsContainer.querySelectorAll('.border');
                placeholders.forEach(placeholder => {
                    if (placeholder.querySelector('.animate-pulse')) {
                        placeholder.remove();
                    }
                });

                // Add actual products
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'border border-gray-200 dark:border-slate-600 rounded-lg p-4 bg-white dark:bg-slate-700 hover:shadow-md transition-all duration-200 cursor-pointer';
                    productCard.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" id="product-${product.handle}" value="${product.handle}" class="product-checkbox rounded border-gray-300 dark:border-slate-600 text-purple-600 focus:ring-purple-500">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-900 dark:text-white text-sm">${product.title}</h4>
                                <p class="text-gray-500 dark:text-gray-400 text-xs">${product.productType || 'No category'}</p>
                                <p class="text-gray-400 dark:text-gray-500 text-xs">${product.priceRange?.minVariantPrice?.amount || 'N/A'} ${product.priceRange?.minVariantPrice?.currencyCode || ''}</p>
                            </div>
                        </div>
                    `;
                    productsContainer.appendChild(productCard);
                });

                // Add event listeners to checkboxes
                document.querySelectorAll('.product-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const productHandle = e.target.value;
                        if (e.target.checked) {
                            selectedProductsForLanding.add(productHandle);
                            console.log('Added product:', productHandle);
                            console.log('Selected products:', Array.from(selectedProductsForLanding));
                        } else {
                            selectedProductsForLanding.delete(productHandle);
                            console.log('Removed product:', productHandle);
                            console.log('Selected products:', Array.from(selectedProductsForLanding));
                        }
                    });
                });

                // Add event listeners for select all/none
                document.getElementById('select-all-products').addEventListener('click', () => {
                    document.querySelectorAll('.product-checkbox').forEach(checkbox => {
                        checkbox.checked = true;
                        selectedProductsForLanding.add(checkbox.value);
                    });
                    updateSelectedCount();
                });

                document.getElementById('deselect-all-products').addEventListener('click', () => {
                    document.querySelectorAll('.product-checkbox').forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    selectedProductsForLanding.clear();
                    updateSelectedCount();
                });

                // Update count when checkboxes change
                document.querySelectorAll('.product-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', updateSelectedCount);
                });

                function updateSelectedCount() {
                    const count = selectedProductsForLanding.size;
                    document.getElementById('selected-count').textContent = `${count} selected`;
                }

                updateSelectedCount();
            }, 1000); // Show loading for 1 second
        }

        // Reset landing form
        function resetLandingForm() {
            document.getElementById('landing-name').value = '';
            document.getElementById('landing-slug').value = '';
            selectedProductsForLanding.clear();
            document.querySelectorAll('.product-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        // Render landing pages list
        function renderLandingPages() {
            if (landingPages.length === 0) {
                landingPagesContainer.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-rocket text-4xl text-slate-400 mb-4"></i>
                        <p class="text-slate-500 dark:text-slate-400">No landing pages created yet. Click "Create New Landing Page" to get started.</p>
                    </div>
                `;
                return;
            }

            landingPagesContainer.innerHTML = landingPages.map(landing => `
                <div class="bg-white dark:bg-slate-700 rounded-lg border border-gray-200 dark:border-slate-600 p-6 shadow-sm">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h5 class="text-lg font-semibold text-gray-900 dark:text-white">${landing.name}</h5>
                            <p class="text-sm text-gray-500 dark:text-gray-400">URL: /${landing.slug}</p>
                            <p class="text-xs text-gray-400 dark:text-gray-500">${landing.products.length} products • Created ${new Date(landing.createdAt).toLocaleDateString()}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <a href="landing-page.html?page=${landing.slug}" target="_blank" class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                <i class="fas fa-external-link-alt mr-1"></i>View
                            </a>
                            <button onclick="deleteLandingPage('${landing.id}')" class="px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm">
                                <i class="fas fa-trash mr-1"></i>Delete
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                        ${landing.products.slice(0, 4).map(productHandle => {
                            const product = products.find(p => p.handle === productHandle);
                            return product ? `
                                <div class="text-xs bg-gray-100 dark:bg-slate-600 rounded px-2 py-1 text-gray-700 dark:text-gray-300 truncate">
                                    ${product.title}
                                </div>
                            ` : '';
                        }).join('')}
                        ${landing.products.length > 4 ? `
                            <div class="text-xs bg-gray-100 dark:bg-slate-600 rounded px-2 py-1 text-gray-700 dark:text-gray-300">
                                +${landing.products.length - 4} more
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Delete landing page
        window.deleteLandingPage = async function(landingId) {
            if (!confirm('Are you sure you want to delete this landing page? This action cannot be undone.')) {
                return;
            }

            try {
                // Remove from localStorage (for admin users)
                try {
                    const existingLandingPages = JSON.parse(localStorage.getItem('landingPages') || '[]');
                    const updatedLandingPages = existingLandingPages.filter(lp => lp.id !== landingId);
                    localStorage.setItem('landingPages', JSON.stringify(updatedLandingPages));
                    console.log('Deleted from localStorage successfully');
                } catch (error) {
                    console.error('Error deleting from localStorage:', error);
                }

                // Remove from local array
                landingPages = landingPages.filter(lp => lp.id !== landingId);
                renderLandingPages();

                // Delete from Firebase (main storage)
                if (window.db) {
                    try {
                        const landingDocRef = doc(window.db, 'landingPages', landingId);
                        await deleteDoc(landingDocRef);
                        console.log('Deleted from Firebase successfully');
                    } catch (error) {
                        console.error('Error deleting from Firebase:', error);
                        throw new Error('Failed to delete from Firebase: ' + error.message);
                    }
                } else {
                    throw new Error('Firebase is not available. Please check your connection.');
                }

                alert('Landing page deleted successfully.');

            } catch (error) {
                console.error('Error deleting landing page:', error);
                alert('Error deleting landing page: ' + error.message);
            }
        };

        // Load existing landing pages on page load
        async function loadLandingPages() {
            try {
                // Always try localStorage first for better reliability
                loadLandingPagesFromLocalStorage();
                
                // Then try Firebase if available
                if (window.db) {
                    try {
                        const landingPagesRef = collection(window.db, 'landingPages');
                        const querySnapshot = await getDocs(landingPagesRef);
                        
                        const firebaseLandingPages = [];
                        querySnapshot.forEach((doc) => {
                            firebaseLandingPages.push({
                                id: doc.id,
                                ...doc.data()
                            });
                        });

                        // Merge Firebase data with localStorage data
                        if (firebaseLandingPages.length > 0) {
                            // Create a map of existing landing pages by slug to avoid duplicates
                            const existingSlugs = new Set(landingPages.map(lp => lp.slug));
                            
                            firebaseLandingPages.forEach(fbLanding => {
                                if (!existingSlugs.has(fbLanding.slug)) {
                                    landingPages.push(fbLanding);
                                }
                            });
                            
                            // Update localStorage with merged data
                            try {
                                localStorage.setItem('landingPages', JSON.stringify(landingPages));
                            } catch (error) {
                                console.error('Error updating localStorage:', error);
                            }
                        }
                        
                        renderLandingPages();
                    } catch (error) {
                        console.error('Error loading from Firebase:', error);
                        // Continue with localStorage data
                    }
                }
            } catch (error) {
                console.error('Error loading landing pages:', error);
                loadLandingPagesFromLocalStorage();
            }
        }

        // Load landing pages from localStorage
        function loadLandingPagesFromLocalStorage() {
            try {
                const savedLandingPages = localStorage.getItem('landingPages');
                if (savedLandingPages) {
                    landingPages = JSON.parse(savedLandingPages);
                    renderLandingPages();
                } else {
                    renderLandingPages(); // This will show the empty state
                }
            } catch (error) {
                console.error('Error loading landing pages from localStorage:', error);
                renderLandingPages(); // This will show the empty state
            }
        }

        // Auto-generate slug from name
        document.getElementById('landing-name').addEventListener('input', function() {
            const name = this.value.trim();
            const slug = name.toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
            document.getElementById('landing-slug').value = slug;
        });

        // Update dashboard statistics
        function updateDashboardStats() {
            document.getElementById('total-products').textContent = products.length;
            document.getElementById('total-landing-pages').textContent = landingPages.length;
            document.getElementById('total-features').textContent = features.length;
            document.getElementById('total-specs').textContent = specifications.length;
        }

        // Handle sidebar navigation
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', (e) => {
                // Remove active class from all links
                document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
                // Add active class to clicked link
                e.currentTarget.classList.add('active');
            });
        });

        // Handle mobile menu
        const mobileMenuBtn = document.querySelector('button.lg\\:hidden');
        const sidebar = document.querySelector('aside');
        mobileMenuBtn.addEventListener('click', () => {
            sidebar.classList.toggle('hidden');
            sidebar.classList.toggle('fixed');
            sidebar.classList.toggle('inset-0');
            sidebar.classList.toggle('z-50');
            sidebar.classList.toggle('lg:block');
        });

        // Update stats when data changes
        const originalRenderFeatures = renderFeatures;
        renderFeatures = function() {
            originalRenderFeatures();
            updateDashboardStats();
        };

        const originalRenderSpecifications = renderSpecifications;
        renderSpecifications = function() {
            originalRenderSpecifications();
            updateDashboardStats();
        };

        const originalRenderLandingPages = renderLandingPages;
        renderLandingPages = function() {
            originalRenderLandingPages();
            updateDashboardStats();
        };

        // Update stats when products are loaded
        const originalLoadProductContent = loadProductContent;
        loadProductContent = async function(productHandle) {
            await originalLoadProductContent(productHandle);
            updateDashboardStats();
        };

        // Update authentication status
        function updateAuthStatus(status, type) {
            const statusText = document.getElementById('auth-status-text');
            const statusDiv = document.getElementById('auth-status');
            statusText.textContent = status;
            if (type === 'success') {
                statusDiv.className = 'mb-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg';
                statusDiv.querySelector('i').className = 'fas fa-check-circle text-green-600 dark:text-green-400 mr-3';
                statusDiv.querySelector('span').className = 'text-green-800 dark:text-green-200';
            } else if (type === 'warning') {
                statusDiv.className = 'mb-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg';
                statusDiv.querySelector('i').className = 'fas fa-exclamation-triangle text-yellow-600 dark:text-yellow-400 mr-3';
                statusDiv.querySelector('span').className = 'text-yellow-800 dark:text-yellow-200';
            } else {
                statusDiv.className = 'mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg';
                statusDiv.querySelector('i').className = 'fas fa-times-circle text-red-600 dark:text-red-400 mr-3';
                statusDiv.querySelector('span').className = 'text-red-800 dark:text-red-200';
            }
        }

        // Sign in function
        async function signIn() {
            if (!window.auth) {
                console.error('Firebase Auth not available');
                alert('Firebase Auth not available. Please check Firebase configuration.');
                return;
            }
            
            try {
                const signInBtn = document.getElementById('sign-in-btn');
                signInBtn.disabled = true;
                signInBtn.textContent = 'Signing in...';
                
                console.log('Attempting sign in with Google...');
                const userCredential = await signInWithPopup(window.auth, window.provider);
                console.log('Signed in successfully:', userCredential.user.uid);
                
                signInBtn.textContent = 'Signed In';
                signInBtn.disabled = true;
                
                // Update status immediately
                updateAuthStatus('Authenticated as ' + (userCredential.user.displayName || userCredential.user.email), 'success');
                
            } catch (error) {
                console.error('Error signing in:', error);
                alert('Error signing in: ' + error.message + '\n\nPlease check your Firebase configuration and ensure Google sign-in is enabled.');
                
                const signInBtn = document.getElementById('sign-in-btn');
                signInBtn.disabled = false;
                signInBtn.textContent = 'Sign In';
            }
        }

        // Check Firebase status
        async function checkFirebaseStatus() {
            const statusText = document.getElementById('firebase-status-text');
            const statusDiv = document.getElementById('firebase-status');
            
            try {
                if (window.db) {
                    console.log('Testing Firebase connection...');
                    // Test Firebase connection with a simple read operation
                    const testRef = collection(window.db, 'landingPages');
                    const querySnapshot = await getDocs(testRef);
                    console.log('Firebase connection test successful');
                    statusText.textContent = 'Connected';
                    statusDiv.className = 'mb-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg';
                    statusDiv.querySelector('i').className = 'fas fa-check-circle text-green-600 dark:text-green-400 mr-3';
                    statusDiv.querySelector('span').className = 'text-green-800 dark:text-green-200';
                } else {
                    console.log('Firebase not initialized');
                    statusText.textContent = 'Not connected (using localStorage)';
                    statusDiv.className = 'mb-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg';
                    statusDiv.querySelector('i').className = 'fas fa-exclamation-triangle text-yellow-600 dark:text-yellow-400 mr-3';
                    statusDiv.querySelector('span').className = 'text-yellow-800 dark:text-yellow-200';
                }
            } catch (error) {
                console.error('Firebase connection error:', error);
                statusText.textContent = 'Error connecting: ' + error.message;
                statusDiv.className = 'mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg';
                statusDiv.querySelector('i').className = 'fas fa-times-circle text-red-600 dark:text-red-400 mr-3';
                statusDiv.querySelector('span').className = 'text-red-800 dark:text-red-200';
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadLandingPages();
            updateDashboardStats();
            checkFirebaseStatus();
            
            // Add event listener for sign-in button
            const signInBtn = document.getElementById('sign-in-btn');
            if (signInBtn) {
                signInBtn.addEventListener('click', signIn);
            }
        });

        document.getElementById('sign-in-btn').addEventListener('click', async () => {
            try {
                await signIn();
            } catch (error) {
                alert('Google sign-in failed: ' + error.message);
            }
        });

        document.getElementById('sign-out-btn').addEventListener('click', async () => {
            try {
                await signOut(window.auth);
                updateAuthStatus('Not authenticated', 'warning');
                document.getElementById('sign-in-btn').style.display = 'block';
                document.getElementById('sign-out-btn').classList.add('hidden');
            } catch (error) {
                alert('Sign out failed: ' + error.message);
            }
        });


    </script>
    <script>
    // Simple username/password protection
    (function() {
        const modal = document.getElementById('auth-modal');
        const loginBtn = document.getElementById('login-btn');
        const usernameInput = document.getElementById('username-input');
        const passwordInput = document.getElementById('password-input');
        const errorDiv = document.getElementById('login-error');
        const USERNAME = 'admin';
        const PASSWORD = '123456';
        function checkLogin() {
            if (usernameInput.value === USERNAME && passwordInput.value === PASSWORD) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            } else {
                errorDiv.textContent = 'Invalid username or password';
                errorDiv.style.display = 'block';
            }
        }
        loginBtn.addEventListener('click', checkLogin);
        passwordInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') checkLogin();
        });
        usernameInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') checkLogin();
        });
        // Prevent scrolling while modal is open
        document.body.style.overflow = 'hidden';
    })();
    </script>
    <!-- Google Tag Manager Configuration -->
    <script src="gtm-config.js"></script>
    </body>
</html>
